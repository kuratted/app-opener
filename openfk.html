<!doctype html>
<html>
<head>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width,initial-scale=1"/>
<title>Open Flipkart App</title>
<style>
  body { font-family: system-ui, sans-serif; padding: 18px; }
  #log { margin-top:12px; color:#333; white-space:pre-wrap; }
  button { padding: 12px 20px; font-size:16px; margin-top:20px; }
  body {
    display: flex;
    flex-direction: column;
    justify-content: center;
    align-items: center;
    height: 100vh;
    background: linear-gradient(135deg, #f7f9fc, #eef1f7);
    font-family: system-ui, -apple-system, "Segoe UI", Roboto, sans-serif;
    margin: 0;
    padding: 0;
    text-align: center;
  }

  .title {
    font-size: 1.8rem;
    font-weight: 600;
    color: #2d2d2d;
    margin-bottom: 24px;
    letter-spacing: -0.5px;
  }

  .open-btn {
    background: linear-gradient(90deg, #2874f0, #0056d2);
    color: #fff;
    border: none;
    padding: 14px 36px;
    font-size: 1.1rem;
    font-weight: 600;
    border-radius: 50px;
    cursor: pointer;
    box-shadow: 0 4px 12px rgba(40, 116, 240, 0.3);
    transition: all 0.2s ease-in-out;
  }
  #log{
    display: none;
  }

  
</style>

<!-- ✅ Native Smart App Banner (optional, iOS Safari will show it) -->
<meta name="apple-itunes-app"
      content="app-id=742044692, app-argument=https://www.flipkart.com/">
</head>
<body>
<h3 class="title">Open Flipkart App</h3>
<div id="log"></div>
<button id="openBtn" class="open-btn">Open in Flipkart</button>


<script>
/* ------------------ URL extractor from the address bar ------------------ */
const DEFAULT_FLIPKART_URL =
  "https://www.lootdealsks.com/";

function log(...args){ 
  const el = document.getElementById('log');
  el.textContent += args.join(' ') + "\n";
  console.log(...args);
}

function getQueryParam(name) {
  const params = new URLSearchParams(window.location.search);
  return params.get(name);
}

function coerceHttps(u) {
  // add https:// if user passed a bare domain
  if (!/^https?:\/\//i.test(u)) return "https://" + u;
  return u;
}

function cleanUrl(u) {
  try {
    // Trim, decode once if it looks percent-encoded
    u = (u || "").trim();
    if (!u) return "";

    // If url is double-encoded (rare), decode safely once
    try {
      const maybe = decodeURIComponent(u);
      if (/^(https?:\/\/|[a-z]+:\/\/)/i.test(maybe)) u = maybe;
    } catch(_) {}

    u = coerceHttps(u);

    // Basic validation
    const parsed = new URL(u);
    // Optional: you can enforce Flipkart only
    // if (!/(\.|^)flipkart\.com$/i.test(parsed.hostname)) return "";

    return parsed.toString();
  } catch (e) {
    return "";
  }
}

function extractTargetUrl() {
  // Prefer ?u=, fallback to ?url=
  const raw = getQueryParam("u") || getQueryParam("url");
  const cleaned = cleanUrl(raw);
  if (cleaned) {
    log("Detected target from URL bar:", cleaned);
    return cleaned;
  }
  log("No valid ?u= found. Falling back to default:", DEFAULT_FLIPKART_URL);
  return DEFAULT_FLIPKART_URL;
}

/* ------------------ App open logic (unchanged behavior) ------------------ */
const APP_STORE_URL = "https://apps.apple.com/in/app/flipkart-shop-online/id742044692";
let FLIPKART_URL = extractTargetUrl();

function isAndroid(){ return /Android/i.test(navigator.userAgent); }
function isIOS(){ return /iPhone|iPad|iPod/i.test(navigator.userAgent) && !window.MSStream; }
function isInstagram(){ return /Instagram/i.test(navigator.userAgent); }

function openFlipkartApp() {
  if (isInstagram() && isIOS()) {
    log("Instagram iOS detected — attempting to open in Safari (system browser).");
    const safariLink = document.createElement('a');
    safariLink.href = FLIPKART_URL;
    safariLink.target = "_blank";
    // Some in-app browsers ignore programmatic clicks; still worth a try:
    safariLink.rel = "noopener";
    document.body.appendChild(safariLink);
    safariLink.click();
    safariLink.remove();
    return;
  }

  if (isAndroid()) {
    log("Android: opening intent URI");
    try {
      const u = new URL(FLIPKART_URL);
      const hostPath = u.hostname + u.pathname + (u.search||'') + (u.hash||'');
      const fallback = encodeURIComponent(FLIPKART_URL);
      const intentUri =
        `intent://${hostPath}#Intent;scheme=https;package=com.flipkart.android;S.browser_fallback_url=${fallback};end`;
      window.location.href = intentUri;
      return;
    } catch(e) {
      log("Invalid URL for intent, opening web:", FLIPKART_URL);
      window.location.href = FLIPKART_URL;
      return;
    }
  }

  if (isIOS()) {
    log("iOS: trying Flipkart Universal Link");
    // try opening the app
    window.location = FLIPKART_URL;
    // fallback to App Store if not installed
    setTimeout(() => {
      if (document.visibilityState === "hidden") return; // user left page → likely opened app
      log("Fallback to App Store");
      window.location = APP_STORE_URL;
    }, 1500);
    return;
  }

  log("Desktop/unknown platform — opening web URL");
  window.location.href = FLIPKART_URL;
}

document.getElementById('openBtn').addEventListener('click', openFlipkartApp);
window.onload = openFlipkartApp;
</script>
</body>
</html>
