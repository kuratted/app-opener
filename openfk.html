
<!doctype html>
<html>
<head>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width,initial-scale=1"/>
<title></title>

<!-- Styles -->
<style>
    :root { --brand: #2874f0; }
    html, body {
      height: 100%;
      margin: 0;
      overflow: hidden; /* ❌ Prevent scrolling */
    }
    body {
      display: flex;
      flex-direction: column;
      justify-content: center;
      align-items: center;
      background: linear-gradient(135deg, #f7f9fc, #eef1f7);
      font-family: system-ui, -apple-system, "Segoe UI", Roboto, sans-serif;
      text-align: center;
      color: #2d2d2d;
    }
    .title {
      font-size: 1.8rem;
      font-weight: 650;
      margin-bottom: 12px;
      letter-spacing: -0.3px;
    }
    .sub {
      font-size: 0.95rem;
      opacity: 0.75;
      margin-top: 10px;
    }
    .btn {
      color: #ffffff;
      background-color: #2d63c8;
      font-size: 19px;
      border: 1px solid #2d63c8;
      padding: 15px 50px;
      border-radius: 8px;
      display: inline-block;
      font-weight: 650;
      cursor: pointer;
      margin: 8px;
      box-shadow: 0 6px 18px rgba(40, 116, 240, 0.25);
      transition: transform 0.15s ease;
    }
    .btn:active {
      transform: translateY(1px);
    }
    .btn.secondary {
      background: #fff;
      color: #2d2d2d;
      box-shadow: 0 6px 18px rgba(0, 0, 0, 0.08);
      border: 1px solid #e6e8ef;
    }
    #fallbackUI {
      display: none;
      margin-top: 20px;
    }
    #log,
    #status {
      display: none;
      white-space: pre-wrap;
      opacity: 0.7;
      font-size: 0.85rem;
      margin-top: 10px;
    }
    #openBtn {
      display: none;
    }
    .show {
      display: inline-block !important;
    }
</style>

<!-- iOS smart app banner (Safari) -->
<meta name="apple-itunes-app" content="app-id=742044692, app-argument=https://www.flipkart.com/">
</head>
<body>
  <h3 class="title">Open Flipkart</h3>
  
  <!-- iOS/desktop action button (from your iOS snippet) -->
  <button id="openBtn" class="btn">Go to App</button>

  <!-- Android fallback UI (from your Android logic) -->
  <div id="fallbackUI">
	<h3 class="title">App not found!</h3>
    <button id="openChromeBtn" class="btn">Go to Chrome</button>
    <!-- <button id="continueWebBtn" class="btn secondary">Continue in Web</button> -->
  </div>
  <div class="sub" id="status"></div>
  

  <div id="log"></div>

<script>
/* ------------------ Shared config/helpers ------------------ */
const DEFAULT_FLIPKART_URL = "https://www.lootdealsks.com/";
const APP_STORE_URL  = "https://apps.apple.com/in/app/flipkart-shop-online/id742044692";
const PLAY_STORE_URL = "https://play.google.com/store/apps/details?id=com.flipkart.android";

const $ = (id)=>document.getElementById(id);
function setStatus(t){ $("status").textContent = t; }

/* Debug logger (kept quiet by default) */
function log(){ /* uncomment to debug:
  const el = $("log");
  el.style.display = 'block';
  el.textContent += Array.from(arguments).join(' ') + "\n";
  console.log.apply(console, arguments);
  */ 
}

function getQueryParam(name){ return new URLSearchParams(location.search).get(name); }
function coerceHttps(u){ return /^https?:\/\//i.test(u) ? u : ("https://" + u); }
function cleanUrl(u){
  try {
    u = (u||"").trim(); if(!u) return "";
    try { const maybe = decodeURIComponent(u); if (/^(https?:\/\/|[a-z]+:\/\/)/i.test(maybe)) u = maybe; } catch(_){}
    u = coerceHttps(u);
    const parsed = new URL(u);
    return parsed.toString();
  } catch { return ""; }
}
function extractTargetUrl(){
  const raw = getQueryParam("u") || getQueryParam("url");
  const cleaned = cleanUrl(raw);
  const out = cleaned || DEFAULT_FLIPKART_URL;
  log("Target URL:", out);
  return out;
}

/* UA detection */
function isAndroid(){ return /Android/i.test(navigator.userAgent); }
function isIOS(){ return /iPhone|iPad|iPod/i.test(navigator.userAgent) && !window.MSStream; }
function isInstagram(){ return /Instagram/i.test(navigator.userAgent); }
function isInAppBrowser(){
  const ua = navigator.userAgent;
  return /(Instagram|FBAN|FBAV|FB_IAB|FBMD|FBSS|FBOP|FBID|Line|Snapchat|Twitter|WeChat|TikTok|MiuiBrowser|HeyTapBrowser|OPR\/|VivoBrowser|HUAWEI|HONOR|SamsungBrowser)/i.test(ua);
}

/* URL composers for intents (Android) */
function toHostPath(u){
  const x = new URL(u);
  return x.hostname + x.pathname + (x.search||"") + (x.hash||"");
}
function flipkartAppIntent(u){
  const hostPath = toHostPath(u);
  const storeFallback = encodeURIComponent(PLAY_STORE_URL);
  return `intent://${hostPath}#Intent;scheme=https;package=com.flipkart.android;S.browser_fallback_url=${storeFallback};end`;
}
function chromeIntentForUrl(u){
  const hostPath = toHostPath(u);
  return `intent://${hostPath}#Intent;scheme=https;package=com.android.chrome;end`;
}

const FLIPKART_URL = extractTargetUrl();

/* ------------------ ANDROID FLOW (from your Android logic) ------------------ */
function showFallbackUI(chromeIntentHref){
  const ui = $("fallbackUI");
  ui.style.display = "block";
  $("openChromeBtn").onclick = () => {
    location.href = chromeIntentHref;
    setTimeout(() => {
      try { window.open(FLIPKART_URL, "_blank", "noopener"); } catch(_){ }
    }, 2000);
  };
  $("continueWebBtn").onclick = () => location.replace(FLIPKART_URL);
  setStatus("If nothing happens, tap a button below.");
}

function openOnAndroid() {
  setStatus("");
  const intent = flipkartAppIntent(FLIPKART_URL);

  // Try opening the Flipkart app
  try {
    location.href = intent;
  } catch (_) {
    location.replace(FLIPKART_URL);
  }

  // If after 100ms the app didn’t open, show fallback instead of auto-opening Chrome
  const t1 = setTimeout(() => {
    if (document.visibilityState === 'hidden') return; // App opened successfully

    // Only show a button to open in Chrome, do not trigger automatically
    showFallbackUI(chromeIntentForUrl(FLIPKART_URL));
  }, 100);

  // Stop fallback if page becomes hidden (app opened)
  document.addEventListener('visibilitychange', () => {
    if (document.visibilityState === 'hidden') clearTimeout(t1);
  });
}
/* ------------------ iOS FLOW (from your iOS snippet) ------------------ */
function openOniOS() {
  if (isInstagram()) {
    // Best-effort: try to escape the in-app browser
    const a = document.createElement('a');
    a.href = FLIPKART_URL; a.target = "_blank"; a.rel = "noopener";
    document.body.appendChild(a); a.click(); a.remove();
    return;
  }
  // Universal link first
  window.location.href = FLIPKART_URL;

  // If app not installed / link unsupported, fall back to App Store
  setTimeout(() => {
    if (document.visibilityState === "hidden") return;
    window.location.href = APP_STORE_URL;
  }, 1500);
}

/* ------------------ Boot ------------------ */
window.addEventListener('load', () => {
  const openBtn = $("openBtn");

  if (isAndroid()) {
    // Android: auto-try, show Android-specific fallback UI if needed
    openOnAndroid();
  } else if (isIOS()) {
    // iOS: show button (visible) and also auto-try on load
    openBtn.classList.add('show');
    openBtn.addEventListener('click', openOniOS);
    // setStatus("");
    openOniOS();
  } else {
    // Desktop/unknown: show button that goes to web/app if macOS iOS-like UA not present
    openBtn.classList.add('show');
    openBtn.addEventListener('click', () => { location.href = FLIPKART_URL; });
    setStatus("You can continue on the web.");
  }
});
</script>
</body>
</html>

